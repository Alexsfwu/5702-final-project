---
title: "EDAV Fall 2019 PSet 5, part A"
author: "Shaofeng Wu, Chengyou Ju, Mingrui Liu, Yujing Song"
output:
  html_document:
    df_print: paged
---
```{r, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = TRUE)
```

This assignment is designed to help you get started on the final project. Be sure to review the final project instructions (https://edav.info/project.html), in particular the new section on reproducible workflow (https://edav.info/project.html#reproducible-workflow), which summarizes principles that we've discussed in class.
    
### 1. The Team

[2 points]

a) Who's on the team? (Include names and UNIs)
    
    Shaofeng Wu, sw3428
    
    Chengyou Ju, cj2624
    
    Mingrui Liu, ml4404
    
    Yujing Song, ys3251

b) How do you plan to divide up the work? (Grading is on a group basis. The point of asking is to encourage you to think about this.)
To

    Chengyou may will work on the topic of salary vs. agency, and he may also use the word cloud to explore the relationship between these two variables. 
    
    Shaofeng will work on the data cleaning and mabipulation, and he will try to find connections among NAs or may come up with interesting topics when doing the data cleaning. 
    
    Yujing will investigate on the topic of salary vs. regions, and she also wants to draw a hierarchical graph using d3 to classify regions with different level of salaries. 
    
    Mingrui will focus on the topic of salary vs. job category. Using different groups of job category to classify different levels of salaries may be something could be explored.
    
### 2. The Questions

[6 points]

List three questions that you hope you will be able to answer from your research.

  Main topic: What factors maybe influence salary?

    a) The relationship between salary vs. regions.

    b) The relationship between salary vs. job category.

    c) The relationship between salary vs. agency.


### 3. Which output format do you plan to use to submit the project? 

[2 points]

(You don't have to use the same format for this assignment -- PSet 5, part A -- and the final project itself.)

Choices are:

pdf_document  

html_document  

bookdown book: https://bookdown.org/yihui/bookdown/

shiny app: https://shiny.rstudio.com/  

(Remember that it's ok to have pieces of the project that don't fit into the chosen output format; in those cases you can provide links to the relevant material.)

    We decide to use the html_document as our output format.


### 4. The Data

[5 points]

What is your data source?  What is your method for importing data? Please be specific. Provide relevant information such as any obstacles you're encountering and what you plan to do to overcome them.

Our data come from https://data.cityofnewyork.us/City-Government/NYC-Jobs/kpav-sd4t, which contains current job postings available on the City of New Yorkâ€™s official jobs site http://www.nyc.gov/html/careers/html/search/search.shtml. The data can be directly exported from the website so there's no obstacle for us to gather the data.

The method we use for importing the data is to export the data from the website and save them in a csv file. Then we use the built-in `read.csv` method to read and store the data as a data frame for future manipulation.


### 5. Provide a short summary, including 2-3 graphs, of your initial investigations. 

[10 points]

```{r}
library(dplyr)
library(corpus)
library(ggplot2)
library(magrittr)
library(forcats)
library(tidyverse)
# Read data from csv file and set empty slots as NAs
job <- read.csv("NYC_jobs.csv")
job[job == ''] <- NA
```

```{r}
categoryList <- job %>%
  select(Job.Category, Job.ID) %>%
  mutate(Job.Category = as.character(Job.Category), 
         Job.Category = gsub(",|&","", Job.Category),
         Job.Category = as.vector(text_sub(Job.Category, 1 , 3, )),
         Job.Category = trimws(Job.Category,"both")) %>%
  rename(Category = Job.Category)

ggplot(categoryList, aes(fct_relevel(fct_rev(fct_infreq(fct_explicit_na(Category,'NA')))))) +
  geom_bar(color = "black", fill = "orange") +
  ggtitle("Job Count by Category") +
  labs(x = "Category", y = "Count") + 
  theme(plot.title = element_text(hjust = 0.5)) + 
  coord_flip()
```
```{r}
job <- job%>%
  mutate(salary = Salary.Range.From+(Salary.Range.To-Salary.Range.From)/2)%>%
  merge(.,categoryList, by = "Job.ID")

Annual = job[job$Salary.Frequency=="Annual",]
ggplot(data = Annual, aes(Annual$salary)) +
  geom_histogram(bins = 40, color = "black", fill = "orange") +
  ggtitle("Salary Distribution (Annual)") + 
  labs(x = "Salary Range", y = "Count") + 
  theme(plot.title = element_text(hjust = 0.5))
```
```{r}
Daily = job[job$Salary.Frequency=="Daily",]
ggplot(data = Daily, aes(Daily$salary)) +
  geom_histogram(bins = 40, color = "black", fill = "orange") +
  ggtitle("Salary Distribution (Daily)") + 
  labs(x = "Salary Range", y = "Count") + 
  theme(plot.title = element_text(hjust = 0.5))
```
```{r}
Hourly = job[job$Salary.Frequency=="Hourly",]
ggplot(data = Hourly, aes(Hourly$salary)) +
  geom_histogram(bins = 40, color = "black", fill = "orange") +
  ggtitle("Salary Distribution (Hourly)") + 
  labs(x = "Salary Range", y = "Count") + 
  theme(plot.title = element_text(hjust = 0.5))
```

From those three plots above, we can have the following obeservations:
1. For most of the jobs, the salaries are given annually. Meanwhile, there are also some jobs which have hourly salaries. Only a few of those jobs have daily salaries.
2. For salaries calculated annually, it has approximately right-skewed normal distribution.
3. For salaries calculated daily, there is no specific pattern regarding the distribution. Some jobs have relatively low daily salaries, while others have much higher salaries.
4. For salaries calculated hourly, most of them has a relatively low value, but there are still some jobs have relatively high hourly salaries.

```{r}
#converting salary on hourly scale to annual scale and daily scale to yearly scale
#no of working days in US in a year: 261 source: 
#no of working hours in US in a day: 8.4 hours 

job = job %>% mutate(salary = if_else( Salary.Frequency == "Annual", round((Salary.Range.From + Salary.Range.To)/2,2),
                                 if_else(Salary.Frequency == "Daily", round((Salary.Range.From + Salary.Range.To)*261/2,2),
                                         round((Salary.Range.From + Salary.Range.To)*261*8.4/2,2))
                                 )
                               )

nyc_jobs %>%
  filter(!is.na(Category)) %>%
  ggplot(aes(x = Category, y = salary)) +
  geom_boxplot(color = "black", fill = "orange") +
  ggtitle("Distribution of Salaries w.r.t Different Categories") + 
  labs(x = "Category", y = "Salary") + 
  theme(plot.title = element_text(hjust = 0.5)) +
  coord_flip()
```

This boxplot gives us a general idea of the salary distribution for different kinds of jobs. For instance, we can see that jobs of Building Operations & Maintenance in general have lower salaries than those of Information Technology & Telecommunmications.

There are a lot of information in the job description and job requirements. Extracting the useful information from these features could be a challenging work.

In conclusion, these are all we have done right now. We identify the number of job postings with respect to different job categories. We also check the salaries of jobs with different salary frequency. Last but not least, we also inspect the salary range for different categories by drawing a boxplot. I think we are off a great start, and we will continue our analysis on the dataset from here.